import{Pool as v}from"@neondatabase/serverless";var n=class extends Error{constructor(t,o){super(`VercelPostgresError - '${t}': ${o}`);this.code=t;this.name="VercelPostgresError"}};function s(e="pool"){let r;switch(e){case"pool":{r=process.env.POSTGRES_URL;break}case"direct":{r=process.env.POSTGRES_URL_NON_POOLING;break}default:{let o=e;throw new n("invalid_connection_type",`Unhandled type: ${o}`)}}return r==="undefined"&&(r=void 0),r}function u(e){return e.includes("-pooler.")}function g(e){return!u(e)}function c(e){try{let r=e.startsWith("postgresql://")?e.replace("postgresql://","https://"):e;return new URL(r).hostname==="localhost"}catch(r){if(r instanceof TypeError||typeof r=="object"&&r!==null&&"message"in r&&typeof r.message=="string"&&r.message==="Invalid URL")return!1;throw r}}function a(e,...r){if(!f(e)||!Array.isArray(r))throw new n("incorrect_tagged_template_call","It looks like you tried to call `sql` as a function. Make sure to use it as a tagged template.\n	Example: sql`SELECT * FROM users`, not sql('SELECT * FROM users')");let t=e[0]??"";for(let o=1;o<e.length;o++)t+=`$${o}${e[o]??""}`;return[t,r]}function f(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)}import{Client as P}from"@neondatabase/serverless";var l=class extends P{async sql(r,...t){let[o,p]=a(r,...t);return this.query(o,p)}};function q(e){let r=(e==null?void 0:e.connectionString)??s("direct");if(!r)throw new n("missing_connection_string","You did not supply a 'connectionString' and no 'POSTGRES_URL_NON_POOLING' env var was found.");if(!c(r)&&!g(r))throw new n("invalid_connection_string","This connection string is meant to be used with a pooled connection. Try `createPool()` instead.");return new l({...e,connectionString:r})}var m=class extends v{constructor(){super(...arguments);this.Client=l}async sql(t,...o){let[p,y]=a(t,...o);return this.query(p,y)}connect(t){return super.connect(t)}};function d(e){let r=(e==null?void 0:e.connectionString)??s("pool");if(!r)throw new n("missing_connection_string","You did not supply a 'connectionString' and no 'POSTGRES_URL' env var was found.");if(!c(r)&&!u(r))throw new n("invalid_connection_string","This connection string is meant to be used with a direct connection. Make sure to use a pooled connection string or try `createClient()` instead.");let t=e==null?void 0:e.maxUses;return typeof EdgeRuntime<"u"&&(t&&t!==1&&console.warn("@vercel/postgres: Overriding `maxUses` to 1 because the EdgeRuntime does not support client reuse."),t=1),new m({...e,connectionString:r,maxUses:t})}var i,C=new Proxy(()=>{},{get(e,r){return i||(i=d()),Reflect.get(i,r)},apply(e,r,t){return i||(i=d()),i.sql(...t)}}),N=C;export{s as a,l as b,q as c,m as d,d as e,C as f,N as g};
